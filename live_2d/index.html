<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css" integrity="sha256-HAaDW5o2+LelybUhfuk0Zh2Vdk8Y2W2UeKmbaXhalfA=" crossorigin="anonymous" /> -->
    <link rel="stylesheet" href="{{ static_url('custom.css') }}">

    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="57x57" href="{{ static_url('favicon/apple-icon-57x57.png') }}">
    <link rel="apple-touch-icon" sizes="60x60" href="{{static_url('favicon/apple-icon-60x60.png')}}">
    <link rel="apple-touch-icon" sizes="72x72" href="{{static_url('favicon/apple-icon-72x72.png')}}">
    <link rel="apple-touch-icon" sizes="76x76" href="{{static_url('favicon/apple-icon-76x76.png')}}">
    <link rel="apple-touch-icon" sizes="114x114" href="{{static_url('favicon/apple-icon-114x114.png')}}">
    <link rel="apple-touch-icon" sizes="120x120" href="{{static_url('favicon/apple-icon-120x120.png')}}">
    <link rel="apple-touch-icon" sizes="144x144" href="{{static_url('favicon/apple-icon-144x144.png')}}">
    <link rel="apple-touch-icon" sizes="152x152" href="{{static_url('favicon/apple-icon-152x152.png')}}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{static_url('favicon/apple-icon-180x180.png')}}">
    <link rel="icon" type="image/png" sizes="192x192"  href="{{static_url('favicon/android-icon-192x192.png')}}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{static_url('favicon/favicon-32x32.png')}}">
    <link rel="icon" type="image/png" sizes="96x96" href="{{static_url('favicon/favicon-96x96.png')}}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{static_url('favicon/favicon-16x16.png')}}">
    <link rel="manifest" href="{{static_url('favicon/manifest.json')}}">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="{{static_url('favicon/ms-icon-144x144.png')}}">
    <meta name="theme-color" content="#ffffff">
    <title>Live 2D Classification</title>
  </head>
  <body>
    <div class="container">
      <div class="text-center"><h1>Live 2D Classification on Krios-1</h1></div>
      <h2 class="text-center">Job Status: Stopped</h2>
      <hr>
      <div class="row">
        <div class="col-md-7 col-xl-8 order-md-last" id="right">
          <button class="btn btn-block btn-secondary" data-toggle="collapse" data-target="class-gallery"> Classes </h3>
          <!-- MRC GALLERY IMPLEMENTATION HERE -->
          <div class="mrc-gallery collapse show" id="class-gallery">
          </div>
          <button class="btn btn-block btn-secondary" data-toggle="collapse" data-target="#console"> Job Output </button>
          <pre><div id="console" class="terminal collapse">
C Refine2D run date and time:              2019-07-03 09:49:01
C Input particle images:                   combined_stack.mrcs
C Input Frealign parameter filename:       classes_30.par
C Input class averages:                    classes_30.mrc
C Output parameter file:                   partial_classes_31_0.par
C Output class averages:                   classes_31.mrc
C First particle to refine:                1
C Last particle to refine:                 1673
C Percent of particles to use:             0.280000
C Pixel size of images (A):                1.200700
C Beam energy (keV):                       300.000000
C Spherical aberration (mm):               2.700000
C Amplitude contrast:                      0.070000
C Mask radius for refinement (A):          150.000000
C Low resolution limit (A):                300.000000
C High resolution limit (A):               11.555555
C Angular step:                            15.000000
C Search range in X (A):                   49.500000
C Search range in Y (A):                   49.500000
C Smoothing factor:                        1.000000
C Padding factor:                          2
C Normalize particles:                     Yes
C Invert particle contrast:                Yes
C Exclude images with blank edges:         No
C Dump intermediate arrays:                Yes
C Output dump filename:                    dump_file_1.dat
C
C           PSI   THETA     PHI       SHX       SHY     MAG  FILM      DF1      DF2  ANGAST  PSHIFT     OCC      LogP      SIGMA   SCORE  CHANGE
      1  316.70    0.00    0.00    -18.49     13.13   10000   -17   8933.8   8640.4   31.00    0.00  100.00     -7667    56.6754   90.88    0.00
      2  209.10    0.00    0.00      4.12     -8.02   10000   -17   8934.5   8641.0   31.00    0.00  100.00    -13634    32.9073   55.71    0.00
      3  226.70    0.00    0.00      8.40    -34.85   10000   -17   8939.5   8646.0   31.00    0.00  100.00     -7397    55.4384  101.27    0.00
      4  362.41    0.00    0.00     -6.66     20.31   10000   -17   8928.7   8635.2   31.00    0.00  100.00    -12317    30.4717   44.20    0.00
      5   48.26    0.00    0.00     -5.05     35.72   10000   -17   8949.4   8655.9   31.00    0.00  100.00     -5734    64.1573  135.43    0.00
      6  302.68    0.00    0.00     10.80     16.84   10000   -17   8940.1   8646.7   31.00    0.00  100.00     -1157    49.9121  143.70    0.00
      7  147.95    0.00    0.00     -4.60      1.06   10000    17   8948.7   8655.2   31.00    0.00  100.00    -10457    45.4284   69.99  -91.82
      8  108.26    0.00    0.00     30.03     11.16   10000   -17   8929.6   8636.2   31.00    0.00  100.00     -6657    70.2589   77.91    0.00
      9  330.66    0.00    0.00    -98.08     82.61   10000   -36   8913.9   8620.4   31.00    0.00  100.00     -3902    62.9924   47.69    0.00
     10  347.41    0.00    0.00    -14.96     32.54   10000   -17   8915.5   8622.0   31.00    0.00  100.00    -15615    36.2638   50.23    0.00
          </div></pre>
          <!-- STREAMING STDOUT TO A "TERMINAL" HERE -->
          <hr>
        </div>
        <!-- Options Pane -->
        <div class="col-md-5 col-xl-4 order-md-first" id="left">
          <form class="form" id="options-form">
            <div class="form-group">
              <label for="warp-directory">Warp Directory </label>
              <input type="text" class="form-control" id="warp-directory" placeholder="/gna/data/cryoem/DATA_COLLECTIONS/WARP/" aria-label="warp-directory">
            </div>
            <div class="btn-toolbar" role="toolbar">
              <div class="btn-group mr-2 mb-2">
                <button type="button" class="btn btn-primary" id="submit-settings">Update Settings</button>
              </div>
              <div class="btn-group mr-2 mb-2">
                <button type="button" class="btn btn-success" id="start-job">Start Job</button>
                <button type="button" class="btn btn-danger" id="stop-job" disabled>Stop Job</button>
              </div>
            </div>
            <hr>
            <div id="subleft">
              <div>
                <div id="user-settings">
                  <h3><button class="btn btn-block btn-secondary" type="button" data-toggle="collapse" data-target="#collapseOne">User Settings </button></h3>
                </div>
                <div id="collapseOne" class="collapse show" aria-labelledby="user-settings">
                  <div class="row">
                    <div class="col-lg">
                      <div class="form-group form-group-inline">
                        <label for="pixel-size">Pixel Size: </label>
                        <div class="input-group">
                          <input type="text" class="form-control" id="pixel-size" placeholder="1.2007" aria-label="pixel-size">
                          <div class="input-group-append"><span class="input-group-text" id=pixel-size-unit>Å</span></div>
                        </div>
                      </div>
                    </div>
                    <div class="col-lg">
                      <div class="form-group form-group-inline">
                        <label for="low-res">Mask Radius: </label>
                        <div class="input-group">
                          <input type="text" class="form-control" id="mask-radius" placeholder="150" aria-label="mask-radius">
                          <div class="input-group-append"><span class="input-group-text" id=mask-radius-unit>Å</span></div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col">
                      <label for="classification-type">Classification Type </label>
                      <div class="form-group btn-group btn-group-toggle" data-toggle="buttons">
                        <label class="btn btn-info active" tabindex="0" rel="popover" data-trigger="hover" data-placement="top" Title="Ab Initio Classification" data-content="Ab initio refinement will generate new random classes and begin classification of a subset of particles starting at the initial high res limit.">
                          <input type="radio" name="classification-type" id="abinit" value="abinit" checked> Ab Initio </input>
                        </label>
                        <label class="btn btn-info" tabindex="0" rel="popover" data-trigger="hover" Title="Seeded Startup Classification" data-placement="top" data-content="Seeded startup will do a full classification starting from the initial high res limit using a subset of particles, but will begin with the most recently generated classes.">
                          <input type="radio" name="classification-type" id="seeded" value="seeded">
                            Seeded Startup
                          </input>
                        </label>
                        <label class="btn btn-info" tabindex="0" rel="popover" data-trigger="hover" data-placement="top" Title="High Resolution Refinement" data-content="Refinement will take existing classes and iteratively classify all particles at the final hi res limit. High chance of not escaping local minima. Use this only when your starting classes are very good!">
                          <input type="radio" name="classification-type" id="refine" value="refine"> Refinement </input>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <hr>
            <div>
              <div id="expert-settings">
                <h3><button class="btn btn-block btn-secondary" type="button" data-toggle="collapse" data-target="#collapseTwo">Expert Settings </button></h3>
              </div>
              <div id="collapseTwo" class="collapse" aria-labelledby="expert-settings">
                <div class="row">
                  <div class="col-lg">
                    <div class="form-group form-group-inline">
                      <label for="high-res-initial">Initial High Res Limit: </label>
                      <div class="input-group mr-2">
                        <input type="text" class="form-control" id="high-res-initial" placeholder="40" aria-label="high-res-initial">
                        <div class="input-group-append"><span class="input-group-text" id=initial-high-res-unit>Å</span></div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="form-group form-group-inline">
                      <label for="pixel-size">Final High Res Limit: </label>
                      <div class="input-group mr-2">
                        <input type="text" class="form-control" id="high-res-final" placeholder="8" aria-label="high-res-final">
                        <div class="input-group-append"><span class="input-group-text" id=final-high-res-unit>Å</span></div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg">
                    <div class="form-group form-group-inline">
                      <label for="startup-cycle-count">Startup Cycles: </label>
                      <input type="text" class="form-control" id="startup-cycle-count" placeholder="40" aria-label="startup-cycle-count">
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="form-group form-group-inline">
                      <label for="refinement-cycle-count">Refinement Cycles: </label>
                      <input type="text" class="form-control" id="refinement-cycle-count" placeholder="8" aria-label="refinement-cycle-count">
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg">
                    <div class="form-group">
                      <label for="start-count">Particle Count Before Starting: </label>
                      <div class="input-group mr-2">
                        <input type="text" class="form-control" id="start-count" placeholder="50000" aria-label="start-count">
                      </div>
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="form-group form-group-inline">
                      <label for="update-count">Additional Particle Count Before Update: </label>
                      <div class="input-group mr-2">
                        <input type="text" class="form-control" id="update-count" placeholder="50000" aria-label="update-count">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg">
                    <div class="form-group">
                      <label for="number-classes">Number of Classes:</label>
                      <div class="input-group mr-2">
                        <input type="text" class="form-control" id="number-classes" placeholder="50" aria-label="number-classes" disabled>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="form-group form-group-inline">
                      <label for="number-per-class"> Initial Particles Per Class: </label>
                      <div class="input-group mr-2">
                        <input type="text" class="form-control" id="number-per-class" placeholder="300" aria-label="number-per-class" disabled>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row mb-2">
                  <div class="col-lg">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="" id="automask" >
                      <label class="form-check-label" for="autocenter">
                        Automask
                      </label>
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" value="" id="autocenter" checked>
                      <label class="form-check-label" for="autocenter">
                        Autocenter
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <hr>
          </form>


        </div>
      </div>
    </div>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.js" integrity="sha256-jGAkJO3hvqIDc4nIY1sfh/FPbV+UK+1N+xJJg6zzr7A=" crossorigin="anonymous"></script> -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js" integrity="sha256-4F7e4JsAJyLUdpP7Q8Sah866jCOhv72zU5E8lIRER4w=" crossorigin="anonymous"></script>
    <script src="{{ static_url('webapp.js') }}"></script>
  </body>
</html>
